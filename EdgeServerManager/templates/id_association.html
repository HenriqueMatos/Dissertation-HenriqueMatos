<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
  crossorigin="anonymous"
/>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
  crossorigin="anonymous"
></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
/>

{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand">ID Association</a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/">Home</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<br />

<div style="text-align: center">
  <div class="container">
    <div class="row">
      <div class="col">
        <select   id="select-1" class="form-select" aria-label="Default select example">
        <option class="option_select1" selected id="select-1-" value="">Open this select menu</option>
        {% for value in DataObject %}
        <option  class="option_select1" id="select-1-{{value["preferred_username"]}}" value="{{value["preferred_username"]}}">{{value["preferred_username"]}}</option>
        {% endfor %}
      </select> 
    </div>
      <div class="col">
        <select id="select-2" class="form-select" aria-label="Default select example">
            <option  class="option_select2" selected id="select-2-" value="">Open this select menu</option>
            {% for value in DataObject %}
            <option class="option_select2" id="select-2-{{value["preferred_username"]}}" value="{{value["preferred_username"]}}">{{value["preferred_username"]}}</option>
            {% endfor %}
          </select> 
    </div>
    </div>
    <br>
    <div class="row">
        <div style="display: inline-flex;justify-content: space-between;" class="col">
          <div class="col-xs-5 col-md-5 col-sm-5">
            <select id="option-select-1-1" class="form-select" disabled>
            </select>
          </div>
          <br>
          <div class="col-xs-5 col-md-5 col-sm-5">
            <select id="option-select-1-2" class="form-select" disabled>
              <option selected value="1">1</option>
              <option value="2">2</option>
            </select>
          </div>
        </div>
        <div style="display: inline-flex;justify-content: space-between;" class="col">
          <div class="col-xs-5 col-md-5 col-sm-5">
            <select  id="option-select-2-1" class="form-select" disabled>
            </select>
          </div>
          <br>
          <div class="col-xs-5 col-md-5 col-sm-5">
            <select  id="option-select-2-2" class="form-select" disabled>
              <option selected value="1">1</option>
              <option value="2">2</option>
            </select>
          </div>
        </div>
      </div>
      <br>
    <div class="row">
      <div class="col">
        <div style="text-align: center">
          <canvas id="myCanvas1"> </canvas>
        </div>
      </div>
      <div class="col">
        <div style="text-align: center">
          <canvas id="myCanvas2"> </canvas>
        </div>
      </div>
    </div>
    </br>
    
  </div>
  
  {% for value in DataObject  %}
  <img hidden src="data:image/jpg;base64,{{ value["frame"] }}" ismap />
  {% endfor %}
{% endblock %} 

<script>

  $(document).ready(function () {

  

    var DataObject="{{DataObject}}"
    var parser = new DOMParser();
    var dom = parser.parseFromString(
      "<!doctype html><body>" + DataObject,
      "text/html"
    );
    var decodedString = dom.body.textContent;
    const result = decodedString.split("'").join('"');
    //console.log(result);
    var jsonData = JSON.parse(result);
    console.log(jsonData);
    $(document).on("input", ".form-select", function () {

      

        valor = $(this).val();
        var indexes = this.id.split("-");
        if(indexes[1]==1){
          var canvas = document.getElementById("myCanvas1");
          const context = canvas.getContext('2d');
          context.clearRect(0, 0, canvas.width, canvas.height);

            var option_select=document.getElementsByClassName("option_select2")
            for (let i = 0; i < option_select.length; i++) {
                option_select[i].removeAttribute('disabled');
            }
            document.getElementById("option-select-1-2").removeAttribute('disabled')
                    var select = document.getElementById("option-select-1-1");
                    select.innerHTML = "";
                    select.removeAttribute('disabled');
                    
            if(valor!=""){
                console.log(this.id, valor);
                document.getElementById("select-2-"+valor).setAttribute("disabled",'true')
                for (var i = 0; i < jsonData.length; i++) {
                  if(jsonData[i]["preferred_username"]==valor){
                    drawImage1(jsonData[i]["frame"])

                    
                  for (var j = 0; j<=jsonData[i]["line_intersection_zone"].length; j++){
                      var opt = document.createElement('option');
                      opt.value = jsonData[i]["line_intersection_zone"][j]["name"];
                      opt.innerHTML = jsonData[i]["line_intersection_zone"][j]["name"];
                      select.appendChild(opt);
                  }
                  var mango = select.appendChild.insertAdjacentHTML(
                    "afterend",
                    AddValue
                  );
                  }
                }
            }
            
        }else{
          var canvas = document.getElementById("myCanvas2");
          const context = canvas.getContext('2d');
          context.clearRect(0, 0, canvas.width, canvas.height);

            var option_select=document.getElementsByClassName("option_select1")
            for (let i = 0; i < option_select.length; i++) {
                option_select[i].removeAttribute('disabled');
            }
            if(valor!=""){
                document.getElementById("select-1-"+valor).setAttribute("disabled",'true')

                for (var i = 0; i < jsonData.length; i++) {
                  if(jsonData[i]["preferred_username"]==valor){
                    drawImage2(jsonData[i]["frame"])
                  }
                }

            }
            
        }
      });
      function drawImage1(frame) {
        var c = document.getElementById("myCanvas1");
        var ctx = c.getContext("2d");
        var image = new Image();
        image.src = "data:image/jpg;base64,"+frame;

        c.style.width =image.width/2.5;
        c.style.height = image.height/2.5;

        ctx.canvas.width = image.width;
        ctx.canvas.height = image.height;
        ctx.drawImage(image, 0, 0);
      }
      function drawImage2(frame) {
        var c = document.getElementById("myCanvas2");
        var ctx = c.getContext("2d");
        var image = new Image();
        image.src = "data:image/jpg;base64,"+frame;
    
        c.style.width =image.width/2.5;
        c.style.height = image.height/2.5;

        ctx.canvas.width = image.width;
        ctx.canvas.height = image.height;
        ctx.drawImage(image, 0, 0);
      }
    })

</script>


